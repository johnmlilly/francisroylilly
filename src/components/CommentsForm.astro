---
import { actions, isInputError } from "astro:actions";
import { Send } from "lucide-react";
const { postSlug } = Astro.props;

const result = Astro.getActionResult(actions.addComment);
const inputErrors = isInputError(result?.error) ? result.error.fields : {};
const generalError =
  result?.error && !isInputError(result.error) ? result.error.message : null;
---

<form method="POST" action={actions.addComment} class="mb-8">
  <input type="hidden" name="postSlug" value={postSlug} />
  <input type="hidden" name="timestamp" value={Date.now().toString()} />

  <div style="position: absolute; left: -5000px;" aria-hidden="true">
    <label for="website">Website (leave blank):</label>
    <input
      type="text"
      id="website"
      name="website"
      tabindex="-1"
      autocomplete="off"
    />
  </div>

  {
    generalError && (
      <div class="mb-4 p-3 bg-red-100 text-red-700 rounded">{generalError}</div>
    )
  }

  {
    result?.data && (
      <div class="mb-4 p-3 bg-green-100 text-green-700 rounded">
        Comment submitted successfully!
      </div>
    )
  }

  <div class="mb-4 flex gap-4">
    <div class="flex-1">
      <label for="name" class="block text-sm font-medium text-gray-700 mb-2"
        >Name</label
      >
      <input
        type="text"
        id="name"
        name="name"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition"
      />
      {
        inputErrors.name && (
          <p class="text-red-500 text-sm mt-1">{inputErrors.name}</p>
        )
      }
    </div>

    <div class="flex-1">
      <label for="email" class="block text-sm font-medium text-gray-700 mb-2"
        >Email (not posted publicly)</label
      >
      <input
        type="email"
        id="email"
        name="email"
        required
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition"
      />
      {
        inputErrors.email && (
          <p class="text-red-500 text-sm mt-1">{inputErrors.email}</p>
        )
      }
    </div>
  </div>

  <div class="mb-6">
    <label for="message" class="block text-sm font-medium text-gray-700 mb-2"
      >Comment</label
    >
    <textarea
      id="message"
      name="message"
      required
      rows="5"
      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent transition resize-none"
    ></textarea>
    {
      inputErrors.message && (
        <p class="text-red-500 text-sm mt-1">{inputErrors.message}</p>
      )
    }
  </div>

  <button
    type="submit"
    class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white text-base rounded-lg transition-colors duration-200">
    <span class="flex items-center gap-2">Add Comment <Send size={18} /></span>
  </button>
</form>
