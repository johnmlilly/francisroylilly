---
import { actions } from "astro:actions";
import { db, Reaction, eq } from "astro:db";

const { postSlug } = Astro.props;

// Fetch the current love count
const reaction = await db
  .select()
  .from(Reaction)
  .where(eq(Reaction.postSlug, postSlug))
  .get();

const loves = reaction?.loves || 0;
---

<form
  method="POST"
  action={actions.addLove}
  class="inline-flex items-center gap-2">
  <input type="hidden" name="postSlug" value={postSlug} />
  <button
    type="submit"
    class="flex items-center gap-1 px-3 py-1 rounded bg-pink-600 hover:bg-pink-700 text-white text-sm">
    ❤️ Love
  </button>
  <span class="text-sm text-gray-600">{loves}</span>
</form>
